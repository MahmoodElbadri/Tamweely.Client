<div class="container py-5 fade-in-up">
  <div class="row justify-content-center">
    <div class="col-12 col-lg-8">
      
      <div class="card card-glass shadow-lg border-0">
        
        <div class="card-header bg-transparent border-bottom-0 pt-4 pb-2">
          @if(isEdit){
            <h2 class="text-gradient font-bold mb-1">Edit Contact</h2>
            <p class="text-muted text-sm">Update contact information</p>
          } @else {
            <h2 class="text-gradient font-bold mb-1">New Contact</h2>
            <p class="text-muted text-sm">Add a new person to your address book</p>
          }
        </div>

        <div class="card-body p-4">
          <form [formGroup]="addAddressForm" (ngSubmit)="onSubmit()">
            
            <div class="row g-4 mb-4">
              <div class="col-md-6 form-group">
                <label for="fullname" class="form-label text-xs uppercase tracking-wider text-muted font-bold">Full Name</label>
                <div class="form-control-wrapper">
                  <input type="text" formControlName="fullname" id="fullname" class="form-control" placeholder="e.g. John Doe">
                </div>
                @if (addAddressForm.get('fullname')?.invalid && addAddressForm.get('fullname')?.touched) {
                  <div class="text-danger text-xs mt-1">Valid name (3-20 chars) required.</div>
                }
              </div>

              <div class="col-md-6 form-group">
                <label for="email" class="form-label text-xs uppercase tracking-wider text-muted font-bold">Email Address</label>
                <input type="email" formControlName="email" id="email" class="form-control" placeholder="john@example.com">
                @if (addAddressForm.get('email')?.invalid && addAddressForm.get('email')?.touched) {
                  <div class="text-danger text-xs mt-1">Valid email required.</div>
                }
              </div>
            </div>

            <div class="row g-4 mb-4">
              <div class="col-md-6 form-group">
                <label for="mobileNumber" class="form-label text-xs uppercase tracking-wider text-muted font-bold">Mobile Number</label>
                <input type="text" formControlName="mobileNumber" id="mobileNumber" class="form-control" placeholder="01xxxxxxxxx">
                @if (addAddressForm.get('mobileNumber')?.invalid && addAddressForm.get('mobileNumber')?.touched) {
                  <div class="text-danger text-xs mt-1">Valid Egyptian number required.</div>
                }
              </div>

              <div class="col-md-6 form-group">
                <label for="dateOfBirth" class="form-label text-xs uppercase tracking-wider text-muted font-bold">Date of Birth</label>
                <input type="text" 
                       formControlName="dateOfBirth" 
                       id="dateOfBirth" 
                       class="form-control" 
                       bsDatepicker 
                       [bsConfig]="bsConfig" 
                       placeholder="Select Date">
                @if (addAddressForm.get('dateOfBirth')?.invalid && addAddressForm.get('dateOfBirth')?.touched) {
                  <div class="text-danger text-xs mt-1">Date is required.</div>
                }
              </div>
            </div>

            <div class="row g-4 mb-4">
              <div class="col-md-6 form-group">
                <label class="form-label text-xs uppercase tracking-wider text-muted font-bold">Department</label>
                <select formControlName="departmentId" class="form-control">
                  <option value="" disabled selected>Select Department</option>
                  @for (dept of depts; track dept.id) {
                    <option [value]="dept.id">{{dept.name}}</option>
                  }
                </select>
              </div>

              <div class="col-md-6 form-group">
                <label class="form-label text-xs uppercase tracking-wider text-muted font-bold">Job Title</label>
                <select formControlName="jobTitleId" class="form-control">
                  <option value="" disabled selected>Select Job Title</option>
                  @for (jobTitle of jobTitles; track jobTitle.id) {
                    <option [value]="jobTitle.id">{{jobTitle.name}}</option>
                  }
                </select>
              </div>
            </div>

            <div class="form-group mb-4">
              <label for="address" class="form-label text-xs uppercase tracking-wider text-muted font-bold">Address</label>
              <input type="text" formControlName="address" id="address" class="form-control" placeholder="Street, City, Region">
              @if (addAddressForm.get('address')?.invalid && addAddressForm.get('address')?.touched) {
                <div class="text-danger text-xs mt-1">Address is required.</div>
              }
            </div>

            <div class="form-group mb-5">
              <label for="photo" class="form-label text-xs uppercase tracking-wider text-muted font-bold">Profile Photo</label>
              <input type="file" 
                     formControlName="photo" 
                     id="photo" 
                     class="form-control" 
                     accept="image/*" 
                     (change)="onFileSelected($event)">
              @if (isEdit) {
                 <div class="text-xs text-muted mt-2">Upload only if you wish to change the current photo.</div>
              }
            </div>

            <div class="d-flex gap-3 pt-2">
              <button type="submit" class="btn btn-gradient hover-lift flex-grow-1">
                {{ isEdit ? 'Update Changes' : 'Save Contact' }}
              </button>
              <a [routerLink]="['/address-book']" class="btn btn-glass hover-glow flex-grow-1 text-center">
                Cancel
              </a>
            </div>

          </form>
        </div>
      </div>

    </div>
  </div>
</div>